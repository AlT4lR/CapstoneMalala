<!DOCTYPE html>
<html lang="{{ babel.locale.language if babel and babel.locale and babel.locale.language else 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}DecoOffice{% endblock %}</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        /* Common Styles Section */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #aab8a8; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #8aa188; }
        .icon-mask {
            display: inline-block;
            background-color: currentColor;
            mask-image: var(--svg-icon);
            mask-repeat: no-repeat;
            mask-position: center;
            mask-size: contain;
        }
        /* Flash message animation styles */
        .flash-message-local {
            opacity: 1;
            transition: opacity 0.5s ease-out; /* Smooth transition for opacity */
        }
        .flash-message-local.fade-out {
            opacity: 0;
        }
        /* Specific styles for the new branches design */
        .branch-bg { background-color: #2d4235; } /* Dark muted green */
        .branch-card-bg { background-color: #aab8a8; } /* Lighter muted green for card */
        .branch-text-dark { color: #2f4f2f; } /* Darker green for text */
        .branch-arrow-color { color: #4a6842; } /* Muted green for arrow */
        .branch-title-color { color: #ffffff; } /* White for title */

        /* Styles to manage sidebar expansion and main content width */
        .sidebar {
            width: 5rem; /* Default width of sidebar (w-20) */
            transition: width 0.3s ease-in-out;
            overflow: hidden; /* Hide content that overflows */
            flex-shrink: 0; /* Prevent sidebar from shrinking */
        }
        .sidebar.expanded {
            width: 16rem; /* Expanded width of sidebar (w-64) */
        }

        /* Main content area needs to push or resize based on sidebar */
        .main-content {
            flex-grow: 1; /* Allows this div to grow to fill available space */
            margin-left: 5rem; /* Default margin to match sidebar's w-20 */
            transition: margin-left 0.3s ease-in-out; /* Smooth transition for margin */
            overflow-y: auto; /* Ensure content scrolls if it exceeds viewport height */
        }
        .sidebar.expanded + .main-content {
            margin-left: 16rem; /* Increase left margin when sidebar expands to w-64 */
        }
        /* Prevent content from overflowing sidebar when sidebar is expanded */
        .sidebar + .main-content {
             width: calc(100% - 5rem); /* Initial width accounting for sidebar */
        }
        .sidebar.expanded + .main-content {
             width: calc(100% - 16rem); /* Width when sidebar is expanded */
        }
    </style>
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { poppins: ['Poppins', 'sans-serif'] },
                    colors: {
                        'custom-bg': '#f5f5f0',
                        'custom-sidebar': '#d7e0d3',
                        'custom-green-active': '#8aa188',
                        'custom-text-dark': '#3a3a3a',
                        'custom-green-darker': '#6f8a6e',
                        'custom-logo-text': '#f6f6e9',
                        'success-bg': '#d4edda',
                        'success-text': '#155724',
                        'success-border': '#c3e6cb',
                        'table-header-bg': '#d7e0d3',
                        'table-row-bg': '#f6f6e9',
                        'status-paid': '#92b38f',
                        'status-pending': '#fcd34d',
                        'calendar-bg-dark': '#3b513c',
                        'calendar-header-bg': '#4a6842',
                        'calendar-sidebar-bg': '#4a6842',
                        'category-office': '#99cc99',
                        'category-meetings': '#ff9999',
                        'category-events': '#9999ff',
                        'category-personal': '#ffff99',
                        'category-others': '#cccccc',
                        'supplier-card-bg': '#0f172a',
                        'branch-bg': '#2d4235',
                        'branch-card-bg': '#aab8a8',
                        'branch-text-dark': '#2f4f2f',
                        'branch-arrow-color': '#4a6842',
                        'branch-title-color': '#ffffff',
                    }
                }
            }
        }
    </script>
    {% block head %}{% endblock %}
</head>
<body class="bg-gray-900 font-poppins text-custom-text-dark antialiased" lang="{{ babel.locale.language if babel and babel.locale and babel.locale.language else 'en' }}">
    <div class="flex h-screen p-2"> {# Main container with 2px padding #}
        <div class="flex w-full h-full bg-custom-bg rounded-2xl overflow-hidden relative"> {# Main app wrapper #}

            {# MODIFICATION HERE: Wrap the include in an element and apply the class to it #}
            <aside class="sidebar"> {# Apply the 'sidebar' class to the <aside> element #}
                {% include "_sidebar.html" %}
            </aside>

            {# Main content area - modified to use margin-left and transition #}
            <div class="main-content flex-1 flex flex-col overflow-y-auto"> {# Removed pl-20, added overflow-y-auto #}
                {% include "_flash_messages.html" %}
                {% block content %}{% endblock %}
            </div>

            {% include "_notifications_panel.html" %}

            {# Language Switcher #}
            {% if babel and babel.locales %}
            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-50">
                <form action="{{ url_for('set_language') }}" method="post" class="flex items-center space-x-2 bg-gray-700/80 text-white p-2 rounded-lg">
                    <label for="locale" class="text-xs font-semibold">{{ _('Language:') }}</label>
                    <select name="locale" id="locale" onchange="this.form.submit()" class="bg-transparent text-xs border-none focus:ring-0 focus:outline-none">
                        {% for loc in babel.locales %}
                            <option value="{{ loc }}" {% if loc == babel.locale.language %}selected{% endif %}>{{ loc.upper() }}</option>
                        {% endfor %}
                    </select>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                </form>
            </div>
            {% endif %}

        </div>
    </div>

    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>