{# website/templates/base.html #}

<!DOCTYPE html>
<html lang="{{ babel.locale.language if babel and babel.locale and babel.locale.language else 'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}DecoOffice{% endblock %}</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        /* Common Styles Section */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #aab8a8; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #8aa188; }
        .icon-mask {
            display: inline-block;
            background-color: currentColor;
            mask-image: var(--svg-icon);
            mask-repeat: no-repeat;
            mask-position: center;
            mask-size: contain;
        }
        /* Flash message animation styles */
        .flash-message-local {
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        .flash-message-local.fade-out {
            opacity: 0;
        }

        /* Styles for the flash message overlay - NEW */
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            to { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        }

        .flash-message-overlay-container { /* Parent container for centering */
            position: fixed; /* Stay in place */
            inset: 0; /* Cover the whole viewport */
            z-index: 50; /* Ensure it's on top */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem; /* Padding around the message */
            pointer-events: none; /* Allow clicks to pass through initially */
        }

        .flash-message-overlay-content {
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 6px 6px rgba(0, 0, 0, 0.15);
            max-width: 30rem; /* Max width for the message box */
            width: 90%; /* Responsive width */
            display: flex;
            flex-direction: column; /* Stack messages vertically */
            overflow: hidden; /* Clip content */
            border-width: 1px; /* Add border for better definition */
            border-style: solid;
            pointer-events: auto; /* Make the message box itself clickable/interactive */
            animation: fadeIn 0.3s ease-out forwards; /* Animation for appearing */
        }

        .flash-message-overlay-content.fade-out {
            animation: fadeOut 0.3s ease-in forwards; /* Animation for disappearing */
        }

        .flash-message-overlay-content .border-b {
            border-bottom-width: 1px !important;
            border-color: rgba(255, 255, 255, 0.3) !important; /* Lighter border for separation */
        }
        
        .flash-message-overlay-content div { /* For individual messages within the container */
            padding: 0.75rem 1rem; /* py-3 px-4 */
            display: flex;
            align-items: center;
            gap: 0.5rem; /* space-x-2 */
        }
        
        .flash-message-overlay-content .text-green-600 { color: #10b981; } /* Tailwind's green-600 */
        .flash-message-overlay-content .text-red-500 { color: #ef4444; } /* Tailwind's red-500 */
        .flash-message-overlay-content .text-blue-500 { color: #3b82f6; } /* Tailwind's blue-500 */

        /* Specific styles for the new branches design */
        .branch-bg { background-color: #2d4235; } /* Dark muted green */
        .branch-card-bg { background-color: #aab8a8; } /* Lighter muted green for card */
        .branch-text-dark { color: #2f4f2f; } /* Darker green for text */
        .branch-arrow-color { color: #4a6842; } /* Muted green for arrow */
        .branch-title-color { color: #ffffff; } /* White for title */

        /* Styles to manage sidebar expansion and main content width */
        .sidebar {
            width: 5rem; /* Default width of sidebar (w-20) */
            transition: width 0.3s ease-in-out;
            overflow: hidden; /* Hide content that overflows */
            flex-shrink: 0; /* Prevent sidebar from shrinking */
        }
        .sidebar.expanded {
            width: 16rem; /* Expanded width of sidebar (w-64) */
        }

        /* Main content area needs to push or resize based on sidebar */
        .main-content {
            flex-grow: 1; /* Allows this div to grow to fill available space */
            /* Default margin-left is handled dynamically below based on sidebar state */
            transition: margin-left 0.3s ease-in-out; /* Smooth transition for margin */
            overflow-y: auto; /* Ensure content scrolls if it exceeds viewport height */
        }
    </style>
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { poppins: ['Poppins', 'sans-serif'] },
                    colors: {
                        'custom-bg': '#f5f5f0',            /* Light creamy background */
                        'custom-sidebar': '#d7e0d3',      /* Muted green for sidebar */
                        'custom-green-active': '#8aa188', /* Primary muted green */
                        'custom-text-dark': '#3a3a3a',    /* Dark text color */
                        'custom-green-darker': '#6f8a6e', /* Darker muted green */
                        'custom-logo-text': '#f6f6e9',    /* Off-white for logo text */
                        'success-bg': '#d4edda',          /* For flash messages */
                        'success-text': '#155724',        /* For flash messages */
                        'success-border': '#c3e6cb',      /* For flash messages */
                        'table-header-bg': '#d7e0d3',     /* Muted green for table headers */
                        'table-row-bg': '#f6f6e9',        /* Light creamy for table rows */
                        'status-paid': '#92b38f',         /* Muted green for paid status */
                        'status-pending': '#fcd34d',      /* Yellow for pending status */
                        'calendar-bg-dark': '#3b513c',    /* Dark green for calendar background */
                        'calendar-header-bg': '#4a6842',  /* Muted green for calendar header */
                        'calendar-sidebar-bg': '#4a6842', /* Muted green for calendar sidebar */
                        'category-office': '#99cc99',     /* Light green for office category */
                        'category-meetings': '#ff9999',   /* Light red for meetings category */
                        'category-events': '#9999ff',     /* Light blue for events category */
                        'category-personal': '#ffff99',   /* Light yellow for personal category */
                        'category-others': '#cccccc',     /* Light gray for others category */
                        'supplier-card-bg': '#0f172a',    /* Dark blue/black for supplier cards */
                        
                        /* --- BRANCH COLORS --- */
                        'branch-bg': '#2d4235',            /* Dark muted green for the main background */
                        'branch-card-bg': '#aab8a8',       /* Lighter muted green for the inner card background */
                        'branch-text-dark': '#2f4f2f',     /* Darker green for text within branch elements */
                        'branch-arrow-color': '#4a6842',   /* Muted green for icons and arrows */
                        'branch-title-color': '#ffffff',   /* White for the "BRANCHES" title */
                        /* --- END BRANCH COLORS --- */
                        
                        'primary-dark-green': '#2d4235',  /* Alias for dark green */
                        'primary-muted-green': '#aab8a8', /* Alias for light green */
                    }
                }
            }
        }
    </script>
    {% block head %}{% endblock %}
</head>
<body class="bg-gray-900 font-poppins text-custom-text-dark antialiased" lang="{{ babel.locale.language if babel and babel.locale and babel.locale.language else 'en' }}">
    <div class="flex h-screen p-2">
        <div class="flex w-full h-full bg-custom-bg rounded-2xl overflow-hidden relative">

            {# Sidebar and Main Content Logic -- Corrected Structure #}
            {% set sidebar_expanded = sidebar_expanded if sidebar_expanded is defined else False %}

            {# Render sidebar if show_sidebar is true #}
            {% if show_sidebar %}
                <aside class="sidebar {% if sidebar_expanded %}expanded{% endif %}">
                    {% include "_sidebar.html" %}
                </aside>
            {% endif %}

            {# --- The main content container - ALWAYS PRESENT #}
            {# It will adjust its margin based on whether the sidebar is shown or not. #}
            <div class="main-content flex-1 flex flex-col overflow-y-auto
                        {% if show_sidebar %}
                            ml-20 {% if sidebar_expanded %}ml-64{% endif %}
                        {% else %}
                            ml-0 w-full
                        {% endif %}">
                {# Flash messages will be rendered here by _flash_messages.html #}
                {% include "_flash_messages.html" %}

                {# --- The SINGLE DEFINITION of the content block #}
                {# Any child template's content will be rendered here. #}
                {% block content %}
                    {# Default content or nothing if no child template provides it #}
                {% endblock %}
            </div>
            {# --- End of main content container --- #}

            {% include "_notifications_panel.html" %}

            {# Language Switcher #}
            {% if babel and babel.locales %}
            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-50">
                <form action="{{ url_for('set_language') }}" method="post" class="flex items-center space-x-2 bg-gray-700/80 text-white p-2 rounded-lg">
                    <label for="locale" class="text-xs font-semibold">{{ _('Language:') }}</label>
                    <select name="locale" id="locale" onchange="this.form.submit()" class="bg-transparent text-xs border-none focus:ring-0 focus:outline-none">
                        {% for loc in babel.locales %}
                            <option value="{{ loc }}" {% if loc == babel.locale.language %}selected{% endif %}>{{ loc.upper() }}</option>
                        {% endfor %}
                    </select>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                </form>
            </div>
            {% endif %}

        </div>
    </div>

    {# Duplicate Tailwind config here is generally not recommended, but kept for standalone page template needs. #}
    {# Ideally, this would be in a separate JS file or handled more cleanly. #}
    <script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: { poppins: ['Poppins', 'sans-serif'] },
                colors: {
                    'custom-bg': '#f5f5f0', /* Light creamy background */
                    'custom-sidebar': '#d7e0d3', /* Muted green for sidebar */
                    'custom-green-active': '#8aa188', /* Muted green for active elements */
                    'custom-text-dark': '#3a3a3a', /* Dark text color */
                    'custom-green-darker': '#6f8a6e', /* Darker green for buttons/accents */
                    'custom-logo-text': '#f6f6e9', /* Off-white for logo text */
                    'success-bg': '#d4edda', /* For flash messages */
                    'success-text': '#155724', /* For flash messages */
                    'success-border': '#c3e6cb', /* For flash messages */
                    'google-button-bg': '#E8F0FE', /* Light blue for Google button background */
                    'google-button-text': '#4285F4', /* Google blue for text */
                    /* Add any other specific hex codes used */
                    'primary-dark-green': '#2d4235', /* For the dark background */
                    'primary-muted-green': '#aab8a8', /* Lighter muted green */
                    
                    /* --- BRANCH COLORS (as discussed) --- */
                    'branch-bg': '#2d4235',            /* Dark muted green for the main background */
                    'branch-card-bg': '#aab8a8',       /* Lighter muted green for the inner card background */
                    'branch-text-dark': '#2f4f2f',     /* Darker green for text within branch elements */
                    'branch-arrow-color': '#4a6842',   /* Muted green for icons and arrows */
                    'branch-title-color': '#ffffff',   /* White for the "BRANCHES" title */
                    /* --- END BRANCH COLORS --- */
                }
            }
        }
    }
</script>

    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>