<!-- website/templates/schedules.html -->
{% extends "base.html" %}
{% block title %}DecoOffice - Schedules{% endblock %}

{% block head %}
<meta name="csrf-token" content="{{ csrf_token() }}">
<!-- FullCalendar CSS & JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/year-view@6.1.13/index.global.min.js'></script>

<style>
/* Match dashboard color scheme */
:root {
  --primary-green: #3a4d39;
  --primary-green-hover: #4b5e4a;
  --bg-light: #f6f7f1;
  --card-bg: #ffffff;
  --text-muted: #6b6b6b;
  --border-color: #e0e0e0;
}

/* Overall layout */
.fc {
  height: 100%;
  display: flex;
  flex-direction: column;
  background-color: var(--card-bg);
  border-radius: 12px;
  padding: 1rem;
}

/* Toolbar */
/* ... (rest of the CSS) ... */

/* Events */
.fc-event {
  border: none;
  border-radius: 4px;
  padding: 2px 6px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  color: #fff !important;
  font-weight: 500;
}
.fc-daygrid-event {
    white-space: normal;
}


/* Year view */
.fc-yearGridMonth-frame {
  border: 1px solid var(--border-color);
  border-radius: 8px;
  background: #fafaf7;
}
.fc-yearGridMonth-name {
  font-weight: 700;
  color: var(--primary-green);
  margin-bottom: 0.25rem;
}

/* Left panel */
/* ... (rest of the CSS) ... */

/* --- START OF FIX: Constraint for List Year View Scroll --- */
/* Target the element that contains the event list within the calendar wrapper */
/* FullCalendar lists usually put a scrollbar on the fc-scroller or fc-view-harness-scroll */
.fc-scroller {
    /* Set max height relative to the parent, preventing it from overflowing the main page. */
    /* Must be !important to override FullCalendar's inline styles */
    max-height: calc(100vh - 200px) !important; /* General safe height based on typical header/footer height */
    overflow-y: auto !important;
}

/* Ensure the parent of the scroller is constrained when in list view */
.fc-list-view .fc-view-harness {
    overflow: hidden !important;
}

/* Re-apply the custom scrollbar if the class is fc-scroller */
.fc-scroller.custom-scrollbar::-webkit-scrollbar { width: 8px; }
.fc-scroller.custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
.fc-scroller.custom-scrollbar::-webkit-scrollbar-thumb { background: #cccccc; border-radius: 10px; }
/* --- END OF FIX: Constraint for List Year View Scroll --- */
</style>

{% endblock %}

{% block content %}
<main class="relative flex-1 p-4 sm:p-6 lg:p-8 flex flex-col bg-[#f6f7f1]">
    
    <!-- --- START OF MODIFICATION: Updated header to match dashboard style --- -->
    <header class="flex justify-between items-center mb-4 border-b border-[#d4d8c4] pb-2 flex-shrink-0">
        <h1 class="text-2xl font-semibold">Schedules</h1>
        <div class="flex items-center gap-4">
             <button id="mobile-controls-btn" class="md:hidden px-4 py-2 bg-white border rounded-lg shadow-sm flex items-center gap-2 text-sm">
                <i class="fa-solid fa-sliders"></i>
                <span>Controls</span>
            </button>
            <a href="{{ url_for('main.archive', back=request.path) }}" class="text-gray-500 hover:text-[#3a4d39]" title="Archive">
                <i class="fa-solid fa-box-archive fa-lg"></i>
            </a>
            {% include "_notification_button.html" %}
        </div>
    </header>
    <!-- --- END OF MODIFICATION --- -->

    <!-- Calendar Layout -->
    <div class="flex-1 flex flex-col md:flex-row gap-6 overflow-hidden h-full">
        
        <!-- Sidebar Overlay (for mobile) -->
        <div id="sidebar-overlay" class="md:hidden fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
        
        <!-- Left Panel -->
        <aside id="schedule-controls" 
               class="w-72 bg-white p-4 flex flex-col gap-4 fixed inset-y-0 left-0 z-50
                      -translate-x-full transition-transform duration-300 ease-in-out
                      md:w-56 md:relative md:translate-x-0 md:inset-auto md:z-auto 
                      border-r md:border md:rounded-lg md:shadow-sm flex-shrink-0">
            
            <div class="flex justify-between items-center md:hidden">
                <h3 class="font-bold text-lg text-[#3a4d39]">Controls</h3>
                <button id="close-sidebar-btn" class="text-2xl">&times;</button>
            </div>
            
            <h3 class="font-bold text-lg text-[#3a4d39] hidden md:block">Views</h3>
            <div class="bg-gray-100 p-1 rounded-lg flex flex-col gap-1">
                <button id="day-view-btn" class="view-btn px-3 py-1.5 text-left text-sm font-medium text-gray-600 rounded-md hover:bg-white hover:shadow">Day View</button>
                <button id="week-view-btn" class="view-btn px-3 py-1.5 text-left text-sm font-medium text-gray-600 rounded-md bg-white shadow">Week View</button>
                <button id="month-view-btn" class="view-btn px-3 py-1.5 text-left text-sm font-medium text-gray-600 rounded-md hover:bg-white hover:shadow">Month View</button>
                <button id="year-view-btn" class="view-btn px-3 py-1.5 text-left text-sm font-medium text-gray-600 rounded-md hover:bg-white hover:shadow">Year View</button>
            </div>
            <hr>
            <div>
                 <h3 class="font-bold text-lg text-[#3a4d39] mb-2">Labels</h3>
                 <div class="space-y-2 text-sm">
                    <div class="flex items-center gap-3"><span class="event-label-dot" style="background-color: #3b82f6;"></span><span>Office</span></div>
                    <div class="flex items-center gap-3"><span class="event-label-dot" style="background-color: #8b5cf6;"></span><span>Meetings</span></div>
                    <div class="flex items-center gap-3"><span class="event-label-dot" style="background-color: #ec4899;"></span><span>Events</span></div>
                    <div class="flex items-center gap-3"><span class="event-label-dot" style="background-color: #f59e0b;"></span><span>Personal</span></div>
                    <div class="flex items-center gap-3"><span class="event-label-dot" style="background-color: #6b7280;"></span><span>Others</span></div>
                </div>
            </div>
        </aside>

        <div class="flex-1 bg-white p-4 rounded-lg border border-gray-200 shadow-sm flex flex-col overflow-hidden">
            <div id="calendar" class="h-full custom-scrollbar"></div>
        </div>
    </div>
</main>

{% include "_create_schedule_modal.html" %}

{% endblock %}

{% block scripts %}
<!-- START OF MODIFICATION: Added Flatpickr JS and initialization script to calendar.js -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    // Initialize the date picker when the schedule modal is used.
    // This is done inside calendar.js for better organization.
    document.addEventListener('DOMContentLoaded', function() {
        flatpickr("#schedule-date", {
            dateFormat: "Y-m-d",
            altInput: true,
            altFormat: "F j, Y",
        });
    });
</script>
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
<!-- END OF MODIFICATION -->
{% endblock %}