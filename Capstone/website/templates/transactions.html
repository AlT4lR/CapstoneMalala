{% extends "base.html" %}

{% block title %}DecoOffice - Transactions{% endblock %}

{% block content %}
<main class="flex-1 p-8 flex flex-col bg-[#fafaf5]">
    <header class="flex justify-between items-center mb-6 border-b border-gray-300 pb-4">
        <h2 class="text-2xl font-bold text-[#3a4d39] uppercase tracking-wide">Transactions</h2>
        <div class="flex items-center gap-4">
            <a href="{{ url_for('main.archive', back=request.path) }}" class="text-gray-500 hover:text-gray-800" title="Archive"><i class="fa-solid fa-box-archive fa-lg"></i></a>
            {% include "_notification_button.html" %}
        </div>
    </header>

    <div class="flex-1 flex items-center justify-center">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
            <button id="add-transaction-btn" class="flex flex-col items-center justify-center w-56 h-56 bg-[#6f8a6e] text-white rounded-2xl shadow-lg border-2 border-white hover:scale-105 transition-transform">
                <i class="fa-solid fa-plus fa-3x mb-3"></i>
                <span class="text-2xl font-semibold">Add</span>
            </button>
            <a href="{{ url_for('main.transactions_pending') }}" class="flex flex-col items-center justify-center w-56 h-56 bg-[#6f8a6e] text-white rounded-2xl shadow-lg border-2 border-white hover:scale-105 transition-transform">
                <i class="fa-solid fa-file-invoice fa-3x mb-3"></i>
                <span class="text-2xl font-semibold">Pending</span>
            </a>
            <a href="{{ url_for('main.transactions_paid') }}" class="flex flex-col items-center justify-center w-56 h-56 bg-[#6f8a6e] text-white rounded-2xl shadow-lg border-2 border-white hover:scale-105 transition-transform">
                <i class="fa-solid fa-file-invoice-dollar fa-3x mb-3"></i>
                <span class="text-2xl font-semibold">Paid</span>
            </a>
        </div>
    </div>
</main>

{% include "_add_transaction_modal.html" %}
{% endblock %}

{% block scripts %}
<!-- START OF MODIFICATION: Added Flatpickr JS and initialization script -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize date pickers in the "Add Transaction" modal
        flatpickr("#check_date", {
            dateFormat: "Y-m-d",
            defaultDate: "today",
            altInput: true,
            altFormat: "F j, Y",
        });
        flatpickr("#due_date", {
            dateFormat: "Y-m-d",
            altInput: true,
            altFormat: "F j, Y",
        });

        const modal = document.getElementById('create-transaction-modal');
        const openBtn = document.getElementById('add-transaction-btn');
        const closeBtn = document.getElementById('close-create-modal-btn');
        const form = document.getElementById('create-transaction-folder-form');
        const successMessage = document.getElementById('success-message-container');

        const openModal = () => {
            form.reset();
            form.style.display = 'block';
            successMessage.classList.add('hidden');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('active'), 10);
        };

        const closeModal = () => {
            modal.classList.remove('active');
            modal.addEventListener('transitionend', () => {
                modal.classList.add('hidden');
            }, { once: true });
        };

        if (modal && openBtn && closeBtn) {
            openBtn.addEventListener('click', openModal);
            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });
        }
        
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Creating...';

            const formData = new FormData(form);

            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest' 
                    }
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    form.style.display = 'none';
                    successMessage.classList.remove('hidden');
                    setTimeout(() => {
                        window.location.href = result.redirect_url;
                    }, 1500);
                } else {
                    window.location.reload();
                }
            } catch (error) {
                console.error('Submission failed:', error);
                window.location.reload();
            }
        });
    });
</script>
<!-- END OF MODIFICATION -->
{% endblock %}